function e(e,t,r,a){Object.defineProperty(e,t,{get:r,set:a,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},a={},i=t.parcelRequiree29f;null==i&&((i=function(e){if(e in r)return r[e].exports;if(e in a){var t=a[e];delete a[e];var i={id:e,exports:{}};return r[e]=i,t.call(i.exports,i,i.exports),i.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){a[e]=t},t.parcelRequiree29f=i),i.register("ktZt2",function(t,r){e(t.exports,"Arena",()=>o);var a=i("1tdZl"),n=i("8kjLe"),s=i("bz6lq");class o{manager;editable;innerArena;container;constructor(e,t){for(let[r,i]of(this.manager=e,this.editable=t,this.innerArena=(0,n.cDiv)({class:"arena"}),this.container=(0,n.cDiv)({class:"arena-container",children:[this.innerArena]}),(0,a.handleDragScroll)(this.container),this.manager.field.entries()))for(let[e,t]of i.entries()){let e=new s.HexFieldDisplay(t,this.manager,this.editable);this.innerArena.append(e.container)}}}}),i.register("1tdZl",function(t,r){e(t.exports,"handleDragScroll",()=>a);function a(e){let t=0,r=0,a=a=>{e.scrollLeft-=a.screenX-t,e.scrollTop-=a.screenY-r,t=a.screenX,r=a.screenY};e.addEventListener("mousedown",e=>{e.preventDefault(),e.stopPropagation(),document.addEventListener("mousemove",a),t=e.screenX,r=e.screenY}),document.addEventListener("mouseup",e=>{document.removeEventListener("mousemove",a)})}}),i.register("8kjLe",function(t,r){e(t.exports,"cDiv",()=>i),e(t.exports,"cBr",()=>n),e(t.exports,"cButton",()=>s),e(t.exports,"cLabel",()=>o),e(t.exports,"uElement",()=>c);let a=[function(e,t){void 0!==t.text&&(e.textContent=t.text)},function(e,t){void 0!==t.title&&(e.title=t.title)},function(e,t){for(let r of t.children??[])"string"==typeof r?e.append(document.createTextNode(r)):e.append(r)},function(e,t){if("string"==typeof t.class)e.classList.add(t.class);else if(t.class instanceof Array)for(let r of t.class)e.classList.add(r)},function(e,t){let r=t.onClick;if(void 0!==r&&e.addEventListener("click",e=>r(e)),void 0!==t.onClickHandled){let r=t.onClickHandled;e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),r(e)})}},function(e,t){for(let r of t.custom??[])r(e)}],i=l(()=>document.createElement("div"),[...a],{});function n(){return document.createElement("br")}l(()=>document.createElement("span"),[...a],{});let s=l(()=>document.createElement("button"),[...a],{}),o=l(()=>document.createElement("label"),[...a],{});function l(e,t,r){return (a=r)=>{let i=e();for(let e of t)e(i,a);return i}}function c(e,t){for(let r of a)r(e,t);return e}}),i.register("bz6lq",function(t,r){e(t.exports,"HexField",()=>c),e(t.exports,"HexFieldDisplay",()=>d);var a=i("fGAG1"),n=i("8kjLe"),s=i("iuIIW"),o=i("iZ2yM"),l=i("31jTI");class c{x;y;background;constructor(e,t,r){this.x=e,this.y=t,this.background=new s.RWProperty(r)}}class d{field;manager;editable;container;constructor(e,t,r){this.field=e,this.manager=t,this.editable=r,this.container=(0,n.cDiv)({class:"hex-field"}),this.container.style.gridColumnStart=(this.field.x+1).toString(),this.container.style.gridRowStart=(this.field.y+1).toString(),this.field.y%2==1&&this.container.classList.add("hex-field-translated"),this.manager.onUpdate.addListener(e=>this.update()),this.update(),this.editable&&(this.container.addEventListener("mousedown",e=>{void 0!==this.manager.backgroundBrush.value&&(e.preventDefault(),e.stopPropagation(),this.field.background.value=this.manager.backgroundBrush.value,this.manager.isCurrentlyBrushing=!0)}),this.container.addEventListener("mouseenter",e=>{void 0!==this.manager.backgroundBrush.value&&this.manager.isCurrentlyBrushing&&(this.field.background.value=this.manager.backgroundBrush.value)}),this.container.addEventListener("dragover",e=>{void 0!==this.manager.currentlyDraggedCharacter&&0===this.localCharacters().length&&e.preventDefault()}),this.container.addEventListener("drop",e=>{void 0!==this.manager.currentlyDraggedCharacter&&0===this.localCharacters().length&&(e.preventDefault(),this.manager.currentlyDraggedCharacter.position=[this.field.x,this.field.y],this.manager.onUpdate.send())})),(0,o.bindOneWayToTarget)(this.field.background,this.container,(e,t)=>t.setAttribute("my-field-background",l.FieldBackground[e])),(0,o.bindOneWayToTarget)(this.manager.backgroundBrush,this.container,(e,t)=>t.classList.toggle("will-change-field",void 0!==e))}update(){for(let e of(this.container.textContent="",this.localCharacters()))this.container.append((0,a.createCharacterFieldEntry)(e,this.editable))}localCharacters(){return this.manager.characters.filter(e=>e.position?.[0]===this.field.x&&e.position?.[1]===this.field.y)}}}),i.register("fGAG1",function(t,r){e(t.exports,"createCharacterFieldEntry",()=>o);var a=i("8kjLe"),n=i("ezM0X"),s=i("2dPTe");function o(e,t){let r=(0,a.cDiv)({class:"character-info",custom:[(0,n.customBind)(e.name,(e,t)=>t.textContent=e.substring(0,6))]}),i=(0,a.cDiv)({class:"character-img"}),o=(0,a.cDiv)({class:"field-character",children:[r,i,(0,a.cDiv)({class:"size-display"}),(0,a.cDiv)({class:"status-display"}),(0,a.cDiv)({class:"weapon-display"})],custom:[(0,n.customBind)(e.name,(e,t)=>t.title=e),(0,n.customBind)(e.characterType,(e,t)=>t.dataset.characterType=s.CharacterType[e]),(0,n.customBind)(e.attitude,(e,t)=>t.dataset.characterAttitude=s.CharacterAttitude[e]),(0,n.customBind)(e.size,(e,t)=>t.dataset.characterSize=s.CharacterSize[e]),(0,n.customBind)(e.status,(e,t)=>t.dataset.characterStatus=s.CharacterStatus[e]),(0,n.customBind)(e.weapon,(e,t)=>t.dataset.characterWeapon=s.CharacterWeapon[e]),(0,n.customBind)(e.isActiveCharacter,(e,t)=>t.classList.toggle("active-character",e))]});return t&&(o.draggable=!0,o.addEventListener("mousedown",e=>{e.stopImmediatePropagation()}),o.addEventListener("dragstart",t=>{o.classList.add("currently-dragged"),e.manager.currentlyDraggedCharacter=e}),o.addEventListener("dragend",t=>{o.classList.remove("currently-dragged"),e.manager.currentlyDraggedCharacter=void 0})),o}}),i.register("ezM0X",function(t,r){e(t.exports,"customBind",()=>n);var a=i("iZ2yM");function n(e,t){return r=>{(0,a.bindOneWayToTarget)(e,r,(e,r)=>{t(e,r)})}}}),i.register("iZ2yM",function(t,r){function a(e,t,r,a){let i=e.get();r(i,t),e.valueChanged.addListenerForObjectLifetime((t,n)=>{void 0!==a&&a(i,n),r(i=e.get(),n)},t)}e(t.exports,"bindOneWayToTarget",()=>a),i("3vmjU")}),i.register("3vmjU",function(t,r){e(t.exports,"CalcProperty",()=>n);var a=i("iuIIW");class n extends a.RProperty{constructor(e,t){for(let r of(super(t()),e))r.valueChanged.addListenerForObjectLifetime((e,r)=>{r.set(t())},this)}}}),i.register("iuIIW",function(t,r){e(t.exports,"RProperty",()=>s),e(t.exports,"RWProperty",()=>o);var a=i("i4jgg");class n{_valueChanged=new a.Sender;get valueChanged(){return this._valueChanged}}class s extends n{currentValue;constructor(e){super(),this.currentValue=e}get(){return this.currentValue}get value(){return this.currentValue}set(e){let t=e!==this.currentValue;this.currentValue=e,t&&this._valueChanged.send(this.currentValue)}isWritable(){return!1}}class o extends s{set(e){super.set(e)}get value(){return this.get()}set value(e){super.set(e)}isWritable(){return!0}}}),i.register("i4jgg",function(t,r){e(t.exports,"Sender",()=>s);var a=i("4Is9Z");class n{listeners=new Set;_nextEvent=new a.ResolvablePromise;listenerFinalizationRegistry=new FinalizationRegistry(e=>{e.isStopped||e.stopListening()});addListener(e){if(this.listeners.has(e))throw Error("Listener is already attached");this.listeners.add(e);let t={stopListening:()=>{if(this.listeners.has(e))this.listeners.delete(e),t.isStopped=!0;else throw Error("Event listening is already stopped.")},isStopped:!1};return t}addListenerForObjectLifetime(e,t){let r=new WeakRef(t),a=this.addListener(t=>{let a=r.deref();void 0!==a?e(t,a):console.log("Target has been deleted by GC")});return this.listenerFinalizationRegistry.register(t,a),a}send(e){for(let t of this.listeners)t(e);let t=this._nextEvent;this._nextEvent=new a.ResolvablePromise,t.resolve(e)}get nextEvent(){return this._nextEvent}[Symbol.asyncIterator](){return{next:async()=>{let e=await this.nextEvent;return{done:!0,value:e}}}}}class s extends n{send(e){super.send(e)}}}),i.register("4Is9Z",function(t,r){e(t.exports,"ResolvablePromise",()=>a);class a extends Promise{_resolve;_reject;_isDone=!1;get isDone(){return this._isDone}constructor(){let e,t;if(super((r,a)=>{e=r,t=a}),void 0===e||void 0===t)throw Error("This shouldn't be possible");this._resolve=e,this._reject=t}resolve(e){if(this._isDone)throw Error("Promise is already done!");this._isDone=!0,this._resolve(e)}reject(e){if(this._isDone)throw Error("Promise is already done!");this._isDone=!0,this._reject(e)}static get[Symbol.species](){return Promise}get[Symbol.toStringTag](){return"ResolvablePromise"}}}),i.register("2dPTe",function(t,r){e(t.exports,"Character",()=>f),e(t.exports,"CharacterSize",()=>c),e(t.exports,"CharacterType",()=>d),e(t.exports,"CharacterAttitude",()=>u),e(t.exports,"CharacterStatus",()=>h),e(t.exports,"CharacterWeapon",()=>g);var a,n,s,o,l,c,d,u,h,g,p=i("iuIIW"),v=i("3vmjU");class f{position;manager;name;initiative;attitude;characterType;size;status;weapon;isActiveCharacter;constructor(e,t,r,a,i,n,s,o,l){this.position=r,this.manager=l,this.name=new p.RWProperty(e),this.initiative=new p.RWProperty(t),this.attitude=new p.RWProperty(a),this.characterType=new p.RWProperty(i),this.size=new p.RWProperty(n),this.status=new p.RWProperty(s),this.weapon=new p.RWProperty(o),this.isActiveCharacter=new v.CalcProperty([this.manager.currentlyActiveCharacter],()=>this.manager.currentlyActiveCharacter.value===this)}store(){return{name:this.name.value,position:this.position,initiative:this.initiative.value,attitude:this.attitude.value,characterType:this.characterType.value,size:this.size.value,status:this.status.value,weapon:this.weapon.value}}static load(e,t){return new f(e.name,e.initiative,e.position,e.attitude,e.characterType,e.size,e.status,e.weapon,t)}}(a=c||(c={}))[a.Tiny=0]="Tiny",a[a.Small=1]="Small",a[a.Medium=2]="Medium",a[a.Large=3]="Large",a[a.Huge=4]="Huge",(n=d||(d={}))[n.Humanoid=0]="Humanoid",n[n.Animal=1]="Animal",n[n.Monster=2]="Monster",n[n.Unknown=3]="Unknown",(s=u||(u={}))[s.Player=0]="Player",s[s.Friendly=1]="Friendly",s[s.Enemy=2]="Enemy",s[s.Neutral=3]="Neutral",(o=h||(h={}))[o.Unknown=0]="Unknown",o[o.Alive=1]="Alive",o[o.Unable=2]="Unable",o[o.Dying=3]="Dying",o[o.Dead=4]="Dead",(l=g||(g={}))[l.Unarmed=0]="Unarmed",l[l.Axe=1]="Axe",l[l.Bow=2]="Bow",l[l.Crossbow=3]="Crossbow",l[l.Dagger=4]="Dagger",l[l.Hammer=5]="Hammer",l[l.Sword=6]="Sword"}),i.register("31jTI",function(t,r){var a,i;e(t.exports,"FieldBackground",()=>a),(i=a||(a={}))[i.None=0]="None",i[i.Grass=1]="Grass",i[i.Road=2]="Road",i[i.Water=3]="Water",i[i.Unavailable=4]="Unavailable",i[i.Tree=5]="Tree",i[i.Wall=6]="Wall",i[i.Vehicle=7]="Vehicle",i[i.Field=8]="Field"});